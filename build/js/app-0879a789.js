/**
 * sushi-finder - Awesome web app to help you find nearby sushi restaraunts.
 * @authors Josh Poole
 * @version v2.0.0
 * @link 
 * @license 
 */
!function(){"use strict";angular.module("app.core",["app.home","app.auth","app.geolocation","app.google","app.yelp","app.sidebar","ui.router","ngMaterial"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("home",{url:"/",controller:"homeController",controllerAs:"homeCtrl",templateUrl:"client/app/home/views/home.html"})}])}(),function(){angular.module("app.auth",[])}(),function(){angular.module("app.geolocation",[])}(),function(){angular.module("app.google",[])}(),function(){angular.module("app.home",[])}(),function(){angular.module("app.sidebar",[])}(),function(){angular.module("app.yelp",[])}(),function(){function e(e){function t(){return e.get("/auth/google")}var a={getGoogleAuth:t};return a}angular.module("app.auth").service("auth",e),e.$inject=["$http","$q"]}(),function(){function e(e,t,a){function o(){var e=t.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){r.currentPosition=t,e.resolve(t)}):(r.currentPosition={},e.resolve(null)),e.promise}function n(e){var t=new a.LatLng(e.latitude,e.longitude),o=new a.LatLng(r.currentPosition.coords.latitude,r.currentPosition.coords.longitude);return a.computeDistance(t,o)}function i(a){if(!a)return t.when();var o="http://maps.googleapis.com/maps/api/geocode/json?sensor=false&latlng=",n=[].concat(a.latitude,a.longitude);o+=n.join();var i=t.defer();return console.log(o),e.get(o).then(function(e){console.debug(e),i.resolve(e.data.results.length>0?e.data.results[0]:e.data)},function(e){i.reject(e)}),i.promise}var r={getCurrentPosition:o,calculateDistance:n,getGeocode:i,currentPosition:{}};return r}angular.module("app.geolocation").factory("geolocation",e),e.$inject=["$http","$q","googleMaps"]}(),function(){function e(){function e(e,t){var a=google.maps.geometry.spherical.computeDistanceBetween(e,t);return(621371e-9*a).toFixed(2)}var t={};return t.LatLng=google.maps.LatLng,t.computeDistance=e,t}angular.module("app.google").factory("googleMaps",e),e.$inject=[]}(),function(){"use strict";function e(e,t,a){function o(){a.getCurrentPosition().then(function(e){l.position=e,a.getGeocode(e.coords).then(function(e){l.geocode=e,i(e)},function(e){console.debug(e)})},function(e){console.debug(e)}),t.searchResults&&(l.results=t.searchResults)}function n(){l.searching=!0,l.searched=!0,l.position?t.searchByPosition(l.position.coords).then(function(e){console.debug(e),l.results=e,l.searching=!1},function(e){console.debug(e),l.searching=!1}):t.search(l.location).then(function(e){l.results=e,l.searching=!1},function(e){console.debug(e),l.searching=!1})}function i(e){if(e){var t=r(e,"locality");t&&(l.locality=t.long_name);var a=r(e,"administrative_area_level_1");a&&(l.state=a.short_name);var o=r(e,"postal_code");o&&(l.postalCode=o.long_name)}}function r(e,t){return _.find(e.address_components,function(e){return e.types.indexOf(t)>=0})}var l=this;l.yelpSearch=n,l.location="",l.searching=!1,l.searched=!1,l.position={},l.geocode={},o()}angular.module("app.home").controller("homeController",e),e.$inject=["auth","yelp","geolocation"]}(),function(){function e(e){function t(){}var a=this;a.term="sushi",a.yelp=e,t()}angular.module("app.sidebar").controller("sidebarController",e),e.$inject=["yelp"]}(),function(){function e(e){function t(t){t.address.distance=e.calculateDistance(t.address.coordinate)}var a={restrict:"A",templateUrl:"client/app/yelp/views/address.html",scope:{address:"="},link:t};return a}angular.module("app.yelp").directive("address",e),e.$inject=["geolocation"]}(),function(){function e(e,t){function a(e){if(!e||""===e)return t.when();var a={location:e};angular.extend(a,r());var o={term:l.term||"sushi",criteria:a};return n(o)}function o(e){if(!e)return t.when();var a=[];a.push(e.latitude),a.push(e.longitude);var o={ll:a.join()};angular.extend(o,r());var i={term:l.term||"sushi",criteria:o};return n(i)}function n(a){var o=t.defer();return e.post("/api/yelp/search",a).then(function(e){l.searchResults=e.data.businesses,o.resolve(l.searchResults)},function(e){o.reject(e)}),o.promise}function i(t){return e.get("api/yelp/business/"+t)}function r(){var e={sort:l.sort,deals_filter:l.dealsOnly};return e}var l={search:a,searchByPosition:o,getBusiness:i,searchResults:[],term:"",radius:10,radiusMin:0,radiusMax:25,dealsOnly:!1,sort:0,sortOptions:[{text:"Best match",value:0},{text:"Distance",value:1},{text:"Highest Rated",value:2}]};return l}angular.module("app.yelp").factory("yelp",e),e.$inject=["$http","$q"]}(),angular.module("app.core").run(["$templateCache",function(e){e.put("app/home/views/home.html",'<form name=homeCtrl.formSearch data-ng-submit=homeCtrl.yelpSearch()><div layout=row><div flex=""><h1>{{homeCtrl.locality}}, {{homeCtrl.state}} {{homeCtrl.postalCode}}</h1></div></div><div layout=row><md-button flex="" class="buttonFindSushi md-raised md-button md-primary md-padding">Find Me Sushi</md-button></div></form><div layout=row layout-padding="" layout-align=space-around data-ng-show=homeCtrl.searching class=text-center><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div layout=row data-ng-show=!homeCtrl.searching><md-content class=md-padding data-ng-show="homeCtrl.searched && (!homeCtrl.results || homeCtrl.results.length === 0)">No Sushi Found</md-content><md-content class=md-padding data-ng-show="homeCtrl.results && homeCtrl.results.length > 0" flex=""><md-list class=businessResultsList><md-item data-ng-repeat="result in homeCtrl.results"><md-item-content><div class=md-tile-left><img src="{{result.image_url.replace(\'http://\',\'https://\')}}" alt={{result.name}} class=businessImage></div><div class=md-tile-content><div layout=row><div flex=""><h3>{{result.name}}<div layout=row layout-sm=column><div flex=""><img src="{{result.rating_img_url.replace(\'http://\',\'https://\')}}" alt=rating></div><div flex=""><small class=reviewCount>{{result.review_count}} reviews</small></div></div><div>{{result.display_phone}}</div></h3></div><div flex="" style=text-align:right;><div data-address=result.location></div></div></div><div layout=row flex=""><span data-ng-repeat="category in result.categories">{{category[0]}} <span data-ng-if=!$last>,&nbsp;</span></span></div></div></md-item-content><md-divider md-inset="" data-ng-if=!$last></md-divider></md-item></md-list></md-content></div>'),e.put("app/sidebar/views/sidebar.html",'<div data-ng-controller="sidebarController as sidebarCtrl"><div layout=row layout-padding=""><div flex=""><label>Search Radius: {{sidebarCtrl.yelp.radius}} miles</label><md-slider id=sliderRadius data-ng-model=sidebarCtrl.yelp.radius flex="" min={{sidebarCtrl.yelp.radiusMin}} max={{sidebarCtrl.yelp.radiusMax}}></md-slider></div></div><div layout=row layout-padding=""><div flex=""><md-switch data-ng-model=sidebarCtrl.yelp.dealsOnly aria-label="Search for deals only">Deals Only</md-switch></div></div><div layout=row layout-padding=""><div flex=""><label>Sort By:</label><md-select data-ng-model=sidebarCtrl.yelp.sort><md-option data-ng-repeat="option in sidebarCtrl.yelp.sortOptions" value={{option.value}}>{{option.text}}</md-option></md-select></div></div><div layout=row layout-padding=""><md-input-container flex=""><label>Search Term</label> <input type=text data-ng-model=sidebarCtrl.yelp.term></md-input-container></div></div>'),e.put("app/yelp/views/address.html","<div><div>{{address.display_address[0]}}</div><div>{{address.display_address[1]}}</div><em>{{address.distance}} miles away</em></div>")}]);