/**
 * sushi-finder - Awesome web app to help you find nearby sushi restaraunts.
 * @authors Josh Poole
 * @version v2.0.0
 * @link 
 * @license 
 */
!function(){"use strict";angular.module("app.core",["app.home","app.auth","app.geolocation","app.google","app.yelp","app.sidebar","ui.router","ngMaterial"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$mdThemingProvider",function(e,t,o,n){t.otherwise("/"),e.state("home",{url:"/",controller:"homeController",controllerAs:"homeCtrl",templateUrl:"app/home/views/home.html"}),n.theme("default").primaryPalette("indigo").accentPalette("deep-orange")}])}(),function(){angular.module("app.auth",[])}(),function(){angular.module("app.geolocation",[])}(),function(){angular.module("app.google",[])}(),function(){angular.module("app.home",[])}(),function(){angular.module("app.sidebar",[])}(),function(){angular.module("app.yelp",[])}(),function(){function e(e){function t(){return e.get("/auth/google")}var o={getGoogleAuth:t};return o}angular.module("app.auth").service("auth",e),e.$inject=["$http","$q"]}(),function(){function e(e,t,o){function n(){var e=t.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){s.currentPosition=t,e.resolve(t)},function(t){s.currentPosition=null,e.reject(t.message)}):(s.currentPosition={},e.resolve(null)),e.promise}function a(e,t,n){var a,i=new o.LatLng(e.latitude,e.longitude);return a=s.searchPosition||n?new o.LatLng(s.searchPosition.lat,s.searchPosition.lng):new o.LatLng(s.currentPosition.coords.latitude,s.currentPosition.coords.longitude),o.computeDistance(i,a)}function i(e){if(!e)return t.when();var o="https://maps.googleapis.com/maps/api/geocode/json?sensor=false&latlng=",n=[].concat(e.latitude,e.longitude);return o+=n.join(),l(o)}function r(e){if(!e)return t.when();var o="https://maps.googleapis.com/maps/api/geocode/json?sensor=false&address=";return o+=encodeURIComponent(e),l(o)}function l(o){var n=t.defer();return e.get(o).then(function(e){n.resolve(e.data.results.length>0?e.data.results[0]:e.data)},function(e){n.reject(e)}),n.promise}var s={getCurrentPosition:n,calculateDistance:a,getGeocodeByCoords:i,getGeocodeByLocation:r,currentPosition:null,searchPosition:null};return s}angular.module("app.geolocation").factory("geolocation",e),e.$inject=["$http","$q","googleMaps"]}(),function(){function e(){function e(e,t){var o=google.maps.geometry.spherical.computeDistanceBetween(e,t);return(621371e-9*o).toFixed(2)}var t={};return t.LatLng=google.maps.LatLng,t.computeDistance=e,t}angular.module("app.google").factory("googleMaps",e),e.$inject=[]}(),function(){"use strict";function e(e,t,o,n,a){function i(){r(),n.searchResults&&(m.results=n.searchResults)}function r(){m.findingPosition=!0,a.getCurrentPosition().then(function(e){m.position=e,d(),m.findingPosition=!1},function(e){console.debug(e),m.findingPosition=!1})}function l(){return m.position||m.location?(m.searching=!0,m.searched=!0,a.searchPosition=null,void(!m.location&&m.position?(d(),n.searchByPosition(m.position.coords).then(function(e){m.results=e,m.searching=!1},function(e){console.debug(e),m.searching=!1})):m.location&&(s(),n.search(m.location).then(function(e){m.results=e,m.searching=!1},function(e){console.debug(e),m.searching=!1})))):void t.show(t.simple().content("Please enter a location or enable GPS location.").position("right"))}function s(){m.location&&(m.geocode=null,a.getGeocodeByLocation(m.location).then(function(e){"ZERO_RESULTS"!==e.status&&(m.geocode=e,a.searchPosition=e.geometry.location,u(e))},function(e){console.debug(e)}))}function d(){m.position&&a.getGeocodeByCoords(m.position.coords).then(function(e){m.geocode=e,u(e)},function(e){console.debug(e)})}function u(e){if(e){var t=c(e,"locality");t&&(m.locality=t.long_name);var o=c(e,"administrative_area_level_1");o&&(m.state=o.short_name);var n=c(e,"postal_code");n&&(m.postalCode=n.long_name)}}function c(e,t){return _.find(e.address_components,function(e){return e.types.indexOf(t)>=0})}function p(){e("sideNavSearchOptions").open()}var m=this;m.yelpSearch=l,m.location="",m.searching=!1,m.searched=!1,m.position=null,m.findingPosition=!1,m.geocode=null,m.showSideNav=p,i()}angular.module("app.home").controller("homeController",e),e.$inject=["$mdSidenav","$mdToast","auth","yelp","geolocation"]}(),function(e){"use strict";function t(){function t(){o.debugInfo.push({key:"screen width",value:e.screen.width}),o.debugInfo.push({key:"screen height",value:e.screen.height})}var o=this;o.showDebugInfo=!1,o.debugInfo=[],t()}angular.module("app.core").controller("rootController",t),t.$inject=[]}(window),function(){function e(e,t){function o(){}function n(){e("sideNavSearchOptions").close()}var a=this;a.term="sushi",a.yelp=t,a.closeSideNav=n,o()}angular.module("app.sidebar").controller("sidebarController",e),e.$inject=["$mdSidenav","yelp"]}(),function(){function e(e,t){function o(e){e.address.distance=t.calculateDistance(e.address.coordinate)}var n={restrict:"A",templateUrl:"app/yelp/views/address.html",scope:{address:"="},link:o};return n}angular.module("app.yelp").directive("address",e),e.$inject=["$templateCache","geolocation"]}(),function(){function e(e,t){function o(e){if(!e||""===e)return t.when();var o={location:e};angular.extend(o,r());var n={term:l.term||"sushi",criteria:o};return a(n)}function n(e){if(!e)return t.when();var o=[];o.push(e.latitude),o.push(e.longitude);var n={ll:o.join()};angular.extend(n,r());var i={term:l.term||"sushi",criteria:n};return a(i)}function a(o){var n=t.defer();return e.post("/api/yelp/search",o).then(function(e){l.searchResults=e.data.businesses,n.resolve(l.searchResults)},function(e){n.reject(e)}),n.promise}function i(t){return e.get("api/yelp/business/"+t)}function r(){var e={sort:l.sort,deals_filter:l.dealsOnly,category_filter:l.categoryFilter.join()};return e}var l={search:o,searchByPosition:n,getBusiness:i,searchResults:[],term:"",radius:10,radiusMin:0,radiusMax:25,dealsOnly:!1,sort:0,sortOptions:[{text:"Best match",value:0},{text:"Distance",value:1},{text:"Highest Rated",value:2}],categoryFilter:["sushi","japanese"]};return l}angular.module("app.yelp").factory("yelp",e),e.$inject=["$http","$q"]}(),angular.module("app.core").run(["$templateCache",function(e){e.put("app/home/views/home.html",'<div layout=""><md-button class=md-raised data-ng-click=homeCtrl.showSideNav() hide-gt-md="">Search Options</md-button></div><div layout=row flex="" data-ng-show=homeCtrl.findingPosition layout-align="center center" layout-padding=""><h4>Finding position</h4><md-progress-circular md-mode=indeterminate md-diameter=24></md-progress-circular></div><div layout=row flex="" layout-padding="" data-ng-show=!homeCtrl.findingPosition><div data-ng-show=homeCtrl.geocode><h1>{{homeCtrl.locality}}, {{homeCtrl.state}} {{homeCtrl.postalCode}}</h1></div><div data-ng-show=!homeCtrl.geocode>Enable location or enter a location below</div></div><form name=homeCtrl.formSearch data-ng-submit=homeCtrl.yelpSearch($event) novalidate><div layout=row><div flex=""><md-input-container><label>Search Near</label> <input name=location type=text data-ng-model=homeCtrl.location></md-input-container></div></div><div layout=row><md-button flex-sm="" class="buttonFindSushi md-raised md-button md-primary md-padding">Find Me Sushi</md-button></div></form><div layout=row layout-padding="" layout-align=space-around data-ng-show=homeCtrl.searching class=text-center><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div layout=row data-ng-show=!homeCtrl.searching><md-content flex="" class=md-padding data-ng-show="homeCtrl.searched && (!homeCtrl.results || homeCtrl.results.length === 0)"><div layout="" layout-align="center center">No Sushi Found</div></md-content><md-content class=md-padding data-ng-show="homeCtrl.results && homeCtrl.results.length > 0" flex=""><md-list class=businessResultsList><md-item data-ng-repeat="result in homeCtrl.results"><md-item-content><div class=md-tile-left><img data-ng-src="{{result.image_url.replace(\'http://\',\'https://\')}}" alt={{result.name}} class=businessImage></div><div class=md-tile-content><div layout=row layout-sm=column><div flex=""><h3>{{$index+1}}.&nbsp;{{result.name}}<div layout=row layout-sm=column><div flex=""><img data-ng-src="{{result.rating_img_url.replace(\'http://\',\'https://\')}}" alt=rating> <small class=reviewCount>{{result.review_count}} reviews</small></div></div><div layout-padding="">{{result.display_phone}}</div></h3></div><div flex="" layout-padding=""><div data-address=result.location></div></div></div><div layout=row layout-sm=column style=padding-left:8px;><div flex="" data-ng-repeat="category in result.categories | limitTo:3">{{category[0]}} <span data-ng-if=!$last>,&nbsp;</span></div></div></div></md-item-content><md-divider md-inset="" data-ng-if=!$last></md-divider></md-item></md-list></md-content></div>'),e.put("app/sidebar/views/sidebar.html",'<div data-ng-controller="sidebarController as sidebarCtrl"><div layout=row layout-padding=""><md-input-container flex=""><label>Search For</label> <input type=text data-ng-model=sidebarCtrl.yelp.term></md-input-container></div><div layout=row layout-padding=""><div flex=""><label>Sort By:</label><md-select data-ng-model=sidebarCtrl.yelp.sort><md-option data-ng-repeat="option in sidebarCtrl.yelp.sortOptions" value={{option.value}}>{{option.text}}</md-option></md-select></div></div><div layout=row layout-padding=""><div flex=""><md-switch data-ng-model=sidebarCtrl.yelp.dealsOnly aria-label="Search for deals only">Deals Only</md-switch></div></div></div>'),e.put("app/yelp/views/address.html","<div><div>{{address.display_address[0]}}</div><div>{{address.display_address[1]}}</div><em>{{address.distance}} miles away</em></div>")}]);