/**
 * sushi-finder - Awesome web app to help you find nearby sushi restaraunts.
 * @authors Josh Poole
 * @version v2.0.0
 * @link 
 * @license 
 */
!function(){"use strict";angular.module("app.core",["app.home","app.auth","app.geolocation","app.google","app.yelp","app.sidebar","ui.router","ngMaterial"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$mdThemingProvider",function(e,t,o,a){t.otherwise("/"),e.state("home",{url:"/",controller:"homeController",controllerAs:"homeCtrl",templateUrl:"app/home/views/home.html"}),a.theme("default").primaryPalette("indigo").accentPalette("deep-orange")}])}(),function(){angular.module("app.auth",[])}(),function(){angular.module("app.geolocation",[])}(),function(){angular.module("app.google",[])}(),function(){angular.module("app.home",[])}(),function(){angular.module("app.sidebar",[])}(),function(){angular.module("app.yelp",[])}(),function(){function e(e){function t(){return e.get("/auth/google")}var o={getGoogleAuth:t};return o}angular.module("app.auth").service("auth",e),e.$inject=["$http","$q"]}(),function(){function e(e,t,o){function a(){var e=t.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){s.currentPosition=t,e.resolve(t)}):(s.currentPosition={},e.resolve(null)),e.promise}function n(e,t,a){var n,i=new o.LatLng(e.latitude,e.longitude);return n=s.searchPosition||a?new o.LatLng(s.searchPosition.lat,s.searchPosition.lng):new o.LatLng(s.currentPosition.coords.latitude,s.currentPosition.coords.longitude),o.computeDistance(i,n)}function i(e){if(!e)return t.when();var o="https://maps.googleapis.com/maps/api/geocode/json?sensor=false&latlng=",a=[].concat(e.latitude,e.longitude);return o+=a.join(),l(o)}function r(e){if(!e)return t.when();var o="https://maps.googleapis.com/maps/api/geocode/json?sensor=false&address=";return o+=encodeURIComponent(e),l(o)}function l(o){var a=t.defer();return e.get(o).then(function(e){a.resolve(e.data.results.length>0?e.data.results[0]:e.data)},function(e){a.reject(e)}),a.promise}var s={getCurrentPosition:a,calculateDistance:n,getGeocodeByCoords:i,getGeocodeByLocation:r,currentPosition:null,searchPosition:null};return s}angular.module("app.geolocation").factory("geolocation",e),e.$inject=["$http","$q","googleMaps"]}(),function(){function e(){function e(e,t){var o=google.maps.geometry.spherical.computeDistanceBetween(e,t);return(621371e-9*o).toFixed(2)}var t={};return t.LatLng=google.maps.LatLng,t.computeDistance=e,t}angular.module("app.google").factory("googleMaps",e),e.$inject=[]}(),function(){"use strict";function e(e,t,o,a,n){function i(){n.getCurrentPosition().then(function(e){c.position=e,l()},function(e){console.debug(e)}),a.searchResults&&(c.results=a.searchResults)}function r(){return c.position||c.location?(c.searching=!0,c.searched=!0,n.searchPosition=null,void(!c.location&&c.position?(l(),a.searchByPosition(c.position.coords).then(function(e){c.results=e,c.searching=!1},function(e){console.debug(e),c.searching=!1})):c.location&&(n.getGeocodeByLocation(c.location).then(function(e){n.searchPosition=e.geometry.location,s(e)},function(e){console.debug(e)}),a.search(c.location).then(function(e){c.results=e,c.searching=!1},function(e){console.debug(e),c.searching=!1})))):void t.show(t.simple().content("Please enter a location or enable GPS location.").position("right"))}function l(){c.position&&n.getGeocodeByCoords(c.position.coords).then(function(e){c.geocode=e,s(e)},function(e){console.debug(e)})}function s(e){if(e){var t=d(e,"locality");t&&(c.locality=t.long_name);var o=d(e,"administrative_area_level_1");o&&(c.state=o.short_name);var a=d(e,"postal_code");a&&(c.postalCode=a.long_name)}}function d(e,t){return _.find(e.address_components,function(e){return e.types.indexOf(t)>=0})}function u(){e("sideNavSearchOptions").open()}var c=this;c.yelpSearch=r,c.location="",c.searching=!1,c.searched=!1,c.position=null,c.geocode=null,c.showSideNav=u,i()}angular.module("app.home").controller("homeController",e),e.$inject=["$mdSidenav","$mdToast","auth","yelp","geolocation"]}(),function(){function e(e,t){function o(){}function a(){e("sideNavSearchOptions").close()}var n=this;n.term="sushi",n.yelp=t,n.closeSideNav=a,o()}angular.module("app.sidebar").controller("sidebarController",e),e.$inject=["$mdSidenav","yelp"]}(),function(){function e(e,t){function o(e){e.address.distance=t.calculateDistance(e.address.coordinate)}var a={restrict:"A",templateUrl:"app/yelp/views/address.html",scope:{address:"="},link:o};return a}angular.module("app.yelp").directive("address",e),e.$inject=["$templateCache","geolocation"]}(),function(){function e(e,t){function o(e){if(!e||""===e)return t.when();var o={location:e};angular.extend(o,r());var a={term:l.term||"sushi",criteria:o};return n(a)}function a(e){if(!e)return t.when();var o=[];o.push(e.latitude),o.push(e.longitude);var a={ll:o.join()};angular.extend(a,r());var i={term:l.term||"sushi",criteria:a};return n(i)}function n(o){var a=t.defer();return e.post("/api/yelp/search",o).then(function(e){l.searchResults=e.data.businesses,a.resolve(l.searchResults)},function(e){a.reject(e)}),a.promise}function i(t){return e.get("api/yelp/business/"+t)}function r(){var e={sort:l.sort,deals_filter:l.dealsOnly,category_filter:l.categoryFilter.join()};return e}var l={search:o,searchByPosition:a,getBusiness:i,searchResults:[],term:"",radius:10,radiusMin:0,radiusMax:25,dealsOnly:!1,sort:0,sortOptions:[{text:"Best match",value:0},{text:"Distance",value:1},{text:"Highest Rated",value:2}],categoryFilter:["sushi","japanese"]};return l}angular.module("app.yelp").factory("yelp",e),e.$inject=["$http","$q"]}(),angular.module("app.core").run(["$templateCache",function(e){e.put("app/home/views/home.html",'<div layout=""><md-button class=md-raised data-ng-click=homeCtrl.showSideNav() hide-gt-md="">Search Options</md-button></div><div layout=row data-ng-show=homeCtrl.geocode><div flex=""><h1>{{homeCtrl.locality}}, {{homeCtrl.state}} {{homeCtrl.postalCode}}</h1></div></div><form name=homeCtrl.formSearch data-ng-submit=homeCtrl.yelpSearch() novalidate><div layout=row><div flex=""><md-input-container><label>Search Near</label> <input name=location type=text data-ng-model=homeCtrl.location></md-input-container></div></div><div layout=row><md-button flex-sm="" class="buttonFindSushi md-raised md-button md-primary md-padding">Find Me Sushi</md-button></div></form><div layout=row layout-padding="" layout-align=space-around data-ng-show=homeCtrl.searching class=text-center><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div layout=row data-ng-show=!homeCtrl.searching><md-content flex="" class=md-padding data-ng-show="homeCtrl.searched && (!homeCtrl.results || homeCtrl.results.length === 0)"><div layout="" layout-align="center center">No Sushi Found</div></md-content><md-content class=md-padding data-ng-show="homeCtrl.results && homeCtrl.results.length > 0" flex=""><md-list class=businessResultsList><md-item data-ng-repeat="result in homeCtrl.results"><md-item-content><div class=md-tile-left><img data-ng-src="{{result.image_url.replace(\'http://\',\'https://\')}}" alt={{result.name}} class=businessImage></div><div class=md-tile-content><div layout=row><div flex=""><h3>{{result.name}}<div layout=row layout-sm=column><div flex=""><img data-ng-src="{{result.rating_img_url.replace(\'http://\',\'https://\')}}" alt=rating></div><div flex=""><small class=reviewCount>{{result.review_count}} reviews</small></div></div><div>{{result.display_phone}}</div></h3></div><div flex="" style=text-align:right;><div data-address=result.location></div></div></div><div layout=row flex=""><span data-ng-repeat="category in result.categories">{{category[0]}} <span data-ng-if=!$last>,&nbsp;</span></span></div></div></md-item-content><md-divider md-inset="" data-ng-if=!$last></md-divider></md-item></md-list></md-content></div>'),e.put("app/sidebar/views/sidebar.html",'<div data-ng-controller="sidebarController as sidebarCtrl"><div layout=row layout-padding=""><div flex=""><label>Search Radius: {{sidebarCtrl.yelp.radius}} miles</label><md-slider id=sliderRadius data-ng-model=sidebarCtrl.yelp.radius flex="" min={{sidebarCtrl.yelp.radiusMin}} max={{sidebarCtrl.yelp.radiusMax}}></md-slider></div></div><div layout=row layout-padding=""><div flex=""><md-switch data-ng-model=sidebarCtrl.yelp.dealsOnly aria-label="Search for deals only">Deals Only</md-switch></div></div><div layout=row layout-padding=""><div flex=""><label>Sort By:</label><md-select data-ng-model=sidebarCtrl.yelp.sort><md-option data-ng-repeat="option in sidebarCtrl.yelp.sortOptions" value={{option.value}}>{{option.text}}</md-option></md-select></div></div><div layout=row layout-padding=""><md-input-container flex=""><label>Search For</label> <input type=text data-ng-model=sidebarCtrl.yelp.term></md-input-container></div></div>'),e.put("app/yelp/views/address.html","<div><div>{{address.display_address[0]}}</div><div>{{address.display_address[1]}}</div><em>{{address.distance}} miles away</em></div>")}]);